<!doctype html>
<html>
<head>
<title>Using RTMP Streaming</title>
<style>
    body { padding: 50px 100px; width: 700px; font: 13px/20px Arial; background: #FFF; }
    a, h1, h2 { color: #369; }
    h1 { font-size: 32px; }
    h2 { margin-top: 50px; }
    h3 { margin-top: 25px; }
    img { display: block; box-shadow: 0 0 5px #999; margin: 0 10px; }
    pre { font-size: 12px; background: #E5F3C8; padding:5px 10px; border: 1px solid #D3EAA4; }
    dd { color: #333; font-style: italic; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    tr { border-bottom: 1px solid #CCC; } 
    tr:nth-child(even) { background: #EEE; }
    td,th { padding: 5px; font-size: 12px; text-align: left; }

</style>
</head><body>

<h1>Using RTMP Streaming</h1>

<p>This guide provides an overview on RTMP streaming with JW Player 6.</p>



<h2>Introduction</h2>

<p>RTMP (<a href="http://en.wikipedia.org/wiki/Real_Time_Messaging_Protocol">Real Time Messaging Protocol</a>) is a system for delivering on-demand and live media to Adobe Flash applications (like JW Player). RTMP supports video in MP4 and FLV and audio in MP3 and AAC. RTMP offers several advantages over regular HTTP video downloads:</p>

<ul>
<li>RTMP can do <strong>live</strong> streaming, so people can watch your video while it is being recorded.</li>
<li>RTMP can do <strong>dynamic</strong> streaming, where the video quality automatically adjusts to changes in bandwidth.</li>
<li>Players can swiftly <strong>seek</strong> to later parts in a video, which is great for files > 5 minutes.</li>
<li>Players maintains a tiny <strong>buffer</strong>, instead of downloading a video during playback, saving bandwidth.</li>
</ul>

<h3>Disadvantages</h3>

<p>However, do note that RTMP has its disadvantages too. The most important ones are:</p>

<ul>
<li>RTMP uses different protocols and ports than HTTP, which makes it vulnerable to getting blocked by (corporate) firewalls. This issue can be prevented by streaming in RTMPT (tunneling over HTTP), but that comes at a server performance cost.</li>
<li>RTMP data is streamed to the player, which means the bandwidth of the connection must be larger than the data-rate of the video. If the connection drops for a couple of seconds, the stream will stutter. This issue can largely be prevented by using <strong>dynamic</strong> streams that include a low-quality file.</li>
</ul>

<p>The biggest drawback is that RTMP only works in Flash and not in HTML5. Therefore, the protocol is basically on its way out today. Newer streaming protocols based upon HTTP (like <a href="hls.html">Apple HLS</a>) have wider device support (iOS, Android). They are currently replacing RTMP.</p>



<h2>Server Support</h2>

<p>In order to use RTMP, your host or CDN needs to have a dedicated RTMP server installed. There are two major offerings, both supported by JW Player:</p>

<ul>
<li>The <a href="http://www.adobe.com/products/flash-media-server-family.html">Flash Media Server</a> from Adobe is the de facto standard. Since Flash is also developed by Adobe, new RTMP functionalities always find their way in FMS first.</li>
<li>The <a href="http://www.wowza.com/">Wowza Media Server</a> from Wowza is a great alternative, because it includes support for a wide variety of streaming protocols.</li>
</ul>

<h3>CDNs</h3>

<p>The following CDNs (Content Delivery Networks) support RTMP and are tested to work great with JW Player. They all support <strong>dynamic</strong> streaming and, with the exception of CloudFront, <strong>live</strong> streaming too:</p>

<ul>
<li><a href="http://www.akamai.com/">Akamai</a></li>
<li><a href="http://www.cdnetworks.com/">CDNetworks</a></li>
<li><a href="http://aws.amazon.com/cloudfront/">CloudFront</a> (Amazon Web Services)</li>
<li><a href="http://www.edgecast.com/">Edgecast</a></li>
<li><a href="http://www.limelight.com/">Limelight</a></li>
</ul>

<h3>Live Streaming</h3>

<p>A key feature of RTMP is the ability to do live streaming, e.g. of presentations, concerts or sports events. Next to JW Player and an RTMP server, one then also needs a small tool to ingest the live video into the server. There's a bunch of such tools available. <a href="http://www.adobe.com/products/flash-media-encoder.html">Flash Live Media Encoder</a> is free and available for Windows and Mac.</p>

<p>With both FMS and Wowza, a live stream is embedded in exactly the same way as an on-demand stream. However, the Akamai, Edgecast and Limelight CDNs require a player to <em>subscribe</em> to a live stream. JW Player <a href="#fcsubscribe">supports this mechanism</a>.</p>

<p>JW Player will embed and play a live stream like an on-demand file, with one exception: instead of displaying a slider to scrub through the timeline, the player will display the <em>title</em> of the event in the display.</p>



<h2>SMIL Manifests</h2>

<p>JW Player is architectured to support playback on any browser and device with a single setup. It does this by <a href="playlists.html">supporting multiple sources</a> for each piece of content. Each source has canonical URL, a single location from where to access it. For RTMP, JW Player uses <strong>SMIL manifests</strong> as this single access point.</p>

<p>SMIL manifests are simple XML files that contain the location of the RTMP application, plus the path to the (one or more) streams stored on the RTMP server. Here is a basic example, using one AAC stream:</p>

<pre>
&lt;smil&gt;
    &lt;head&gt;
        &lt;meta base="rtmp://example.com/ondemand/" /&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;video src="myPodcast.aac" /&gt;
    &lt;/body&gt;
&lt;/smil&gt;
</pre>

<p>FLV, AAC, MP3 and live streams are loaded in exactly the same way. It's not needed to set any <em>mp4:</em> or <em>mp3:</em> prefixes, as is sometimes described in the documentation of RTMP servers. JW Player takes care of that.</p>

<p>Note that SMIL manifests are subject to <a href="crossdomain.html">Cross-domain Security Restrictions</a>. If your SMIL files are located on a different server than your website or player, you have to setup a <em>crossdomain.xml</em> file.</p>

<h3>Dynamic</h3>

<p>Here is a more extensive example, using three different streams. This manifest sets up a so-called <strong>dynamic</strong> stream, which enables JW Player to switch between quality levels during playback:</p>

<pre>
&lt;smil&gt;
  &lt;head&gt;
    &lt;meta base="rtmp://example.com/ondemand/" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;switch&gt;
      &lt;video src="myVideo-high.mp4" height="720" system-bitrate="2000000" width="1280" /&gt;
      &lt;video src="myVideo-medium.mp4" height="360" system-bitrate="800000" width="640" /&gt;
      &lt;video src="myVideo-low.mp4" height="180" system-bitrate="300000" width="320" /&gt;
    &lt;/switch&gt;
  &lt;/body&gt;
&lt;/smil&gt;
</pre>

<p>The switching of quality is automatically done by JW Player, who compares the:</p>

<ul>
    <li>Connection bandwidth to the <em>system-bitrate</em> of the videos.</li>
    <li>Player display width to the <em>width</em> of the videos.</li>
</ul>

<p>The highest quality video that fits both the bandwidth and the screen width is displayed. Users are able to override this by selecting a quality from a controlbar popup menu. If the bandwidth and width are omitted, the player will default to the first video in the manifest.</p>



<h2>Embedding a Stream</h2>

<p>The manifest needs to be stored on a web server and then loaded into JW Player using <a href="embedding.html">jwplayer().setup()</a>. If, for example, your manifest is saved as <em>/assets/myVideo.smil</em> on your server, you can load it into JW Player using this setup block:</p>

<pre>
jwplayer("myElement").setup({
    file: "/assets/myVideo.smil",
    height: 360,
    image: "/assets/myVideo.jpg",
    width: 640
});
</pre>

<h3>Advanced</h3>

<p>Above setup does not leverage the multi-device options of JW Player, since only RTMP is provided. Therefore, let's extend this setup by including a separate MP4 video that can play on mobile devices:</p>

<pre>
jwplayer("myElement").setup({
    playlist: [{
        image: "/assets/myVideo.jpg",
        sources: [
            { file: "/assets/myVideo.smil" },
            { file: "/assets/myVideo.mp4" }
        ]
    }],
    height: 360,
    primary: "flash",
    width: 640
});
</pre>

<p>This setup will play the RTMP stream on all browsers that have Flash installed (therefore, Flash is set to be the <strong>primary</strong> mode). On all devices that don't have Flash, the MP4 video is played in HTML5. See <a href="playlists.html">Working with Playlists</a> for more info on loading multiple sources per playlist item.</p>



<h2>The Streamer Option</h2>

<p>SMIL manifests nicely abstract and group the properties of an RTMP stream, allowing JW Player to load multiple media formats and serve many browser and devices with one setup. However, SMIL manifests add complexity in that they need to be authored and hosted in addition to the streams.</p>

<p>Therefore, it is also possible to load RTMP streams without a SMIL manifest in JW Player. This is done by adding the <strong>streamer</strong> property to every item in your playlist. It is set to the URL of your RTMP application. Here's an example:</p>

<pre>
jwplayer("myElement").setup({
    playlist: [{
        image: "/assets/myVideo.jpg",
        sources: [
            { file: "myVideo.mp4", type: "rtmp" }
        ],
        streamer: "rtmp://example.com/ondemand/"
    }],
    height: 360,
    width: 640
});
</pre>

<p>Note the <strong>type</strong> option, which tells JW Player this stream is not a basic MP4 download, but part of the RTMP stream. Without this option, the inline setup won't work.</p>

<h3>Advanced</h3>

<p>Here's a more advanced example, including a dynamic stream and a regular MP4 download for mobile playback:</p>

<pre>
jwplayer("myElement").setup({
    height: 360,
    playlist: [{
        image: "/assets/myLivestream.jpg",
        sources: [
            { file: "myVideo-high.mp4", type: "rtmp" },
            { file: "myVideo-medium.mp4", type: "rtmp" },
            { file: "myVideo-low.mp4", type: "rtmp" },
            { file: "http://example.com/assets/myVideo.mp4" }
        ],
        streamer: "rtmp://example.com/ondemand/"
    }],
    primary: "flash",
    width: 640
});
</pre>

<p>Note it is not possible to load RTMP streams in feeds using the <strong>streamer</strong> option, since RSS has no mechanism to distinguish between streaming MP4 files and progressive MP4 files. SMIL manifests must be used in such setups.</p>


<h2>Configuration Options</h2>

<p>RTMP supports a few configuration options to tweak playback of the streams. They are set in a dedicated <em>rtmp</em> options block.</p>

<h3><a name="bufferlength"></a>Buffer Length</h3>

<p>By default, JW Player tries to maintain a buffer length of <em>3 seconds</em> for RTMP video. This means that 3 seconds of video is fetched from the server and ready to play at all times. This can be changed to another value using the RTMP <strong>bufferlength</strong> option:</p>

<pre>
jwplayer("myElement").setup({
    file: "/assets/myVideo.smil",
    height: 360,
    image: "/assets/myVideo.jpg",
    rtmp: {
        bufferlength: 0.1
    },
    width: 640
});
</pre>

<p>Sane values range from <em>0.1</em> (for low latency live streams) to <em>10</em> (to prevent frequent re-buffering).</p>

<h3><a name="fcsubscribe"></a>FC Subscribe</h3>

<p>When streaming live streams using the Akamai, Edgecast or Limelight CDN, players cannot simply connect to the live stream. Instead, they have to subscribe to it, by sending a so-called <strong>FC Subscribe</strong> call to the server. JW Player includes support for this, using the RTMP <strong>subscribe</strong> option:</p>

<pre>
jwplayer("myElement").setup({
    file: "/assets/myLivestream.smil",
    height: 360,
    image: "/assets/myLivestream.jpg",
    rtmp: {
        subscribe: true
    },
    width: 640
});
</pre>

<p>This functionality also works in combination with <strong>dynamic</strong> streaming. The player automatically detects the stream levels and subscribes to each.</p>

<h3><a name="securetoken"></a>Secure Token</h3>

<p>The Wowza Media Server includes a feature called <a href="http://www.wowza.com/forums/content.php?115">Secure Token</a> that is used to protect your streams from downloading. It works by having the player send a token to the server, which is verified before the stream is started. JW Player supports this mechanism, using the RTMP <strong>securetoken</strong> option:</p>

<pre>
jwplayer("myElement").setup({
    file: "/assets/myVideo.smil",
    height: 360,
    image: "/assets/myVideo.jpg",
    rtmp: {
        securetoken: "Kosif093n203a"
    },
    width: 640
});
</pre>

<p>Since the token is part of your HTML, downloaders could extract it to grab your streams. Incremental security is achieved by compiling this token into the player. See our <a href="http://developer.longtailvideo.com">developer site</a> for more information (note: very techie!).</p>



</body>
</html>